<%@ page contentType="text/html;charset=UTF-8" language="java" %> <%@ include file="/WEB-INF/jsp/commonTagLib.jsp" %>
<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <title>통합검색 결과</title>
    </head>

    <body class="subBody">
        <!--s: Main-->
        <main>
            <section class="subWrap">
                <!-- s:container-->
                <section class="container">
                    <!-- s: content-->
                    <section class="content">
                        <!-- s: search -->
                        <div class="totalSearch">
                            <p class="textbox"><input type="text" placeholder="검색어를 입력해주세요." /></p>
                            <p class="btnbox">
                                <a href="#" class="btn-search"><img src="/img/btn-search-w.svg" alt="search" /></a>
                                <span><input type="checkbox" id="inResult" /> <label for="inResult">결과내 재검색</label></span>
                            </p>
                        </div>
                        <!-- e: search -->

                        <div class="tab-container">
                            <!-- 탭 버튼 및 스크롤 영역 -->
                            <div class="tab-header-wrapper">
                                <!-- 왼쪽 스크롤 버튼 -->
                                <button id="scrollLeftBtn" class="nav-button left">
                                    <img src="/img/tab-arrow-left-w.svg" alt="Previous" />
                                </button>

                                <!-- 실제 스크롤되는 영역 -->
                                <div id="tabScrollArea" class="tab-scroll-area">
                                    <ul class="tab-list">
                                        <!-- 스크롤 테스트를 위해 10개 항목 추가 -->
                                        <li class="active">
                                            <a href="#" class="tab-button" data-tab="all">전체<span>129</span></a>
                                        </li>
                                        <li class="tab-item">
                                            <a href="#" class="tab-button" data-tab="tab1">공지사항<span>28</span></a>
                                        </li>
                                        <li class="tab-item">
                                            <a href="#" class="tab-button" data-tab="tab2">부동산뉴스<span>28</span></a>
                                        </li>
                                        <li class="tab-item">
                                            <a href="#" class="tab-button" data-tab="tab3">행정규칙(훈령,예규,고시)<span>12</span></a>
                                        </li>
                                        <li class="tab-item">
                                            <a href="#" class="tab-button" data-tab="tab4">주택정책제도<span>34</span></a>
                                        </li>
                                        <li class="tab-item">
                                            <a href="#" class="tab-button" data-tab="tab5">연구보고서<span>19</span></a>
                                        </li>
                                        <li class="tab-item">
                                            <a href="#" class="tab-button" data-tab="tab6">탭메뉴6<span>9</span></a>
                                        </li>
                                        <li class="tab-item">
                                            <a href="#" class="tab-button" data-tab="tab7">탭메뉴7<span>5</span></a>
                                        </li>
                                        <li class="tab-item">
                                            <a href="#" class="tab-button" data-tab="tab8">탭메뉴8<span>9</span></a>
                                        </li>
                                        <li class="tab-item">
                                            <a href="#" class="tab-button" data-tab="tab9">탭메뉴9<span>10</span></a>
                                        </li>
                                    </ul>
                                </div>

                                <!-- 오른쪽 스크롤 버튼 -->
                                <button id="scrollRightBtn" class="nav-button right">
                                    <img src="/img/tab-arrow-right-w.svg" alt="Next" />
                                </button>
                            </div>

                            <!-- 탭 내용 영역 -->
                            <div class="tab-content-container">
                                <!-- 탭 내용 추가 (스크롤 테스트를 위해 10개 모두 추가) -->
                                <div id="all" class="tab-content active">
                                    <!-- category-list -->
                                    <div class="result">
                                        <div class="title-category">
                                            <h3>공지사항<span>29</span></h3>
                                            <a href="#" class="plusMore" data-target-tab="tab1">더보기</a>
                                            <!--<a href="#" class="plusMore" data-target-tab="tab2">더보기</a>-->
                                        </div>
                                        <div class="cont-detail">
                                            <a href="#">
                                                <dl>
                                                    <dt>2021년도 분양계획 및 <strong>입주계획</strong> 자료제출 요청<span class="date">2025-10-15</span></dt>
                                                    <dd>
                                                        <p>
                                                            우리협회는 회원사로부터 "2021년도 분양계획 및 <strong>입주계획</strong>"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 없는 경우에는 유선으로 연락주시기 바랍니다. "2021년도 분양계획
                                                            및 <strong>입주계획</strong>"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 ….우리협회는 회원사로부터 "2021년도 분양계획 및 <strong>입주계획</strong>"을 파악하여 대 정부 및 국회 정책
                                                            건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 없는 경우에는 유선으로 연락주시기 바랍니다. "2021년도 분양계획 및 <strong>입주계획</strong>"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료
                                                            제출을 요청드리며 해당사항이 ….
                                                        </p>
                                                        <span class="addFile">첨부파일문서.pdf</span>
                                                    </dd>
                                                </dl>
                                            </a>
                                            <a href="#">
                                                <dl>
                                                    <dt>2021년도 분양계획 및 입주계획 자료제출 요청<span class="date">2025-10-15</span></dt>
                                                    <dd>
                                                        우리협회는 회원사로부터 "2021년도 분양계획 및 입주계획"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 없는 경우에는 유선으로 연락주시기 바랍니다. 우리협회는 회원사로부터 "2021년도
                                                        분양계획 및 입주계획"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 ….
                                                    </dd>
                                                </dl>
                                            </a>
                                        </div>
                                    </div>
                                    <!-- e: category-list -->
                                    <!-- category-list -->
                                    <div class="result">
                                        <div class="title-category">
                                            <h3>부동산 뉴스<span>29</span></h3>
                                            <a href="#" class="plusMore" data-target-tab="tab2">더보기</a>
                                        </div>
                                        <div class="cont-detail">
                                            <a href="#">
                                                <dl>
                                                    <dt>2021년도 분양계획 및 입주계획 자료제출 요청<span class="date">2025-10-15</span></dt>
                                                    <dd>
                                                        우리협회는 회원사로부터 "2021년도 분양계획 및 <strong>입주계획</strong>"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 없는 경우에는 유선으로 연락주시기 바랍니다. "2021년도 분양계획 및
                                                        <strong>입주계획</strong>"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 ….
                                                    </dd>
                                                </dl>
                                            </a>
                                            <a href="#">
                                                <dl>
                                                    <dt>2021년도 분양계획 및 입주계획 자료제출 요청<span class="date">2025-10-15</span></dt>
                                                    <dd>
                                                        우리협회는 회원사로부터 "2021년도 분양계획 및 입주계획"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 없는 경우에는 유선으로 연락주시기 바랍니다. 우리협회는 회원사로부터 "2021년도
                                                        분양계획 및 입주계획"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 ….
                                                    </dd>
                                                </dl>
                                            </a>
                                        </div>
                                    </div>
                                    <!-- e: category-list -->
                                </div>
                                <div id="tab1" class="tab-content">
                                    <!-- category-list -->
                                    <div class="result">
                                        <div class="title-category">
                                            <h3>공지사항<span>29</span></h3>
                                        </div>
                                        <div class="cont-detail">
                                            <a href="#">
                                                <dl>
                                                    <dt>2021년도 분양계획 및 <strong>입주계획</strong> 자료제출 요청<span class="date">2025-10-15</span></dt>
                                                    <dd>
                                                        <p>
                                                            우리협회는 회원사로부터 "2021년도 분양계획 및 <strong>입주계획</strong>"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 없는 경우에는 유선으로 연락주시기 바랍니다. "2021년도 분양계획
                                                            및 <strong>입주계획</strong>"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 ….우리협회는 회원사로부터 "2021년도 분양계획 및 <strong>입주계획</strong>"을 파악하여 대 정부 및 국회 정책
                                                            건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 없는 경우에는 유선으로 연락주시기 바랍니다. "2021년도 분양계획 및 <strong>입주계획</strong>"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료
                                                            제출을 요청드리며 해당사항이 ….
                                                        </p>
                                                        <span class="addFile">첨부파일문서.pdf</span>
                                                    </dd>
                                                </dl>
                                            </a>
                                            <a href="#">
                                                <dl>
                                                    <dt>2021년도 분양계획 및 입주계획 자료제출 요청<span class="date">2025-10-15</span></dt>
                                                    <dd>
                                                        우리협회는 회원사로부터 "2021년도 분양계획 및 입주계획"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 없는 경우에는 유선으로 연락주시기 바랍니다. 우리협회는 회원사로부터 "2021년도
                                                        분양계획 및 입주계획"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 ….
                                                    </dd>
                                                </dl>
                                            </a>
                                            <a href="#">
                                                <dl>
                                                    <dt>2021년도 분양계획 및 입주계획 자료제출 요청<span class="date">2025-10-15</span></dt>
                                                    <dd>
                                                        우리협회는 회원사로부터 "2021년도 분양계획 및 입주계획"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 없는 경우에는 유선으로 연락주시기 바랍니다. 우리협회는 회원사로부터 "2021년도
                                                        분양계획 및 입주계획"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 ….
                                                    </dd>
                                                </dl>
                                            </a>
                                            <a href="#">
                                                <dl>
                                                    <dt>2021년도 분양계획 및 입주계획 자료제출 요청<span class="date">2025-10-15</span></dt>
                                                    <dd>
                                                        우리협회는 회원사로부터 "2021년도 분양계획 및 입주계획"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 없는 경우에는 유선으로 연락주시기 바랍니다. 우리협회는 회원사로부터 "2021년도
                                                        분양계획 및 입주계획"을 파악하여 대 정부 및 국회 정책 건의 등 자료로 활용하고자 붙임과 같이 자료 제출을 요청드리며 해당사항이 ….
                                                    </dd>
                                                </dl>
                                            </a>
                                        </div>
                                    </div>
                                    <!-- e: category-list -->
                                    <!-- s:pasing-->
                                    <div class="pasing">
                                        <ul>
                                            <li>
                                                <a href="#"><img src="../assets/img/btn-pasing-left-2.svg" alt="first" /></a>
                                                <a href="#"><img src="../assets/img/btn-pasing-left-1.svg" alt="Previous" /></a>
                                            </li>
                                            <li>
                                                <a href="#" class="on">1</a>
                                                <a href="#">2</a>
                                                <a href="#">3</a>
                                                <a href="#">4</a>
                                            </li>
                                            <li>
                                                <a href="#"><img src="../assets/img/btn-pasing-right-1.svg" alt="next" /></a>
                                                <a href="#"><img src="../assets/img/btn-pasing-right-2.svg" alt="last" /></a>
                                            </li>
                                        </ul>
                                    </div>
                                    <!-- e:pasing-->
                                </div>
                                <div id="tab2" class="tab-content">
                                    <div class="result">
                                        <div class="title-category">
                                            <h3>부동산뉴스<span>29</span></h3>
                                        </div>
                                        <div class="cont-detail">내용</div>
                                    </div>
                                </div>
                                <div id="tab3" class="tab-content">
                                    <div class="result">
                                        <div class="title-category">
                                            <h3>행정규칙(훈령,예규,고시)<span>29</span></h3>
                                        </div>
                                        <div class="cont-detail">내용</div>
                                    </div>
                                </div>
                                <div id="tab4" class="tab-content">
                                    <div class="result">
                                        <div class="title-category">
                                            <h3>탭4<span>0</span></h3>
                                        </div>
                                        <div class="cont-detail">내용</div>
                                    </div>
                                </div>
                                <div id="tab5" class="tab-content">
                                    <div class="title-category">
                                        <h3>탭5<span>0</span></h3>
                                    </div>
                                    <div class="cont-detail">내용</div>
                                </div>
                                <div id="tab6" class="tab-content">
                                    <div class="title-category">
                                        <h3>탭6<span>0</span></h3>
                                    </div>
                                    <div class="cont-detail">내용</div>
                                </div>
                                <div id="tab7" class="tab-content">
                                    <div class="title-category">
                                        <h3>탭7<span>0</span></h3>
                                    </div>
                                    <div class="cont-detail">내용</div>
                                </div>
                                <div id="tab8" class="tab-content">
                                    <div class="title-category">
                                        <h3>탭8<span>0</span></h3>
                                    </div>
                                    <div class="cont-detail">내용</div>
                                </div>
                                <div id="tab9" class="tab-content">
                                    <div class="title-category">
                                        <h3>탭9<span>0</span></h3>
                                    </div>
                                    <div class="cont-detail">내용</div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <!-- e: content-->
                </section>
                <!-- e:container-->
            </section>
        </main>
        <!--e: Main-->
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // --- 확인 로그: 스크립트 초기화 및 버전 명시 ---
                console.log("--- TAB SYSTEM V4.1 INITIALIZED (ENHANCED HREF DEBUGGING) ---");
                // -----------------------------------------------------------

                // --- 상수 정의 및 필수 요소 확인 ---
                const tabScrollArea = document.getElementById("tabScrollArea");
                const scrollLeftBtn = document.getElementById("scrollLeftBtn");
                const scrollRightBtn = document.getElementById("scrollRightBtn");
                const tabListContainer = tabScrollArea?.querySelector(".tab-list");

                const SCROLL_AMOUNT = 150;
                const TOLERANCE = 5;
                let isInitialized = false;

                if (!tabScrollArea || !scrollLeftBtn || !scrollRightBtn) {
                    console.error("Critical: Tab container or navigation buttons not found. Check DOM IDs.");
                }

                /**
                 * 스크롤 버튼의 활성화/비활성화 상태를 업데이트합니다.
                 */
                const updateScrollButtons = () => {
                    if (!isInitialized || !tabScrollArea) return;

                    const { scrollLeft, scrollWidth, clientWidth } = tabScrollArea;
                    const maxScrollLeft = scrollWidth - clientWidth;
                    const isScrollable = maxScrollLeft > TOLERANCE;

                    if (!isScrollable) {
                        tabScrollArea.scrollLeft = 0;
                        scrollLeftBtn.disabled = true;
                        scrollRightBtn.disabled = true;
                    } else {
                        scrollLeftBtn.disabled = scrollLeft <= TOLERANCE;
                        scrollRightBtn.disabled = scrollLeft >= maxScrollLeft - TOLERANCE;
                    }
                };

                /**
                 * 활성 탭이 뷰포트에 보이도록 스크롤하고 버튼을 업데이트합니다.
                 */
                const scrollToView = (element) => {
                    if (!tabScrollArea) return;

                    const containerRect = tabScrollArea.getBoundingClientRect();
                    const elementRect = element.getBoundingClientRect();
                    let scrollDelta = 0;

                    if (elementRect.left < containerRect.left) {
                        scrollDelta = elementRect.left - containerRect.left - 20;
                    } else if (elementRect.right > containerRect.right) {
                        scrollDelta = elementRect.right - containerRect.right + 20;
                    }

                    if (scrollDelta !== 0) {
                        tabScrollArea.scrollBy({ left: scrollDelta, behavior: "smooth" });
                    }

                    setTimeout(updateScrollButtons, 150);
                };

                /**
                 * 지정된 탭 LI 요소와 콘텐츠 ID를 사용하여 탭을 활성화합니다.
                 */
                const activateTab = (targetLi, targetTabId) => {
                    // 1. 기존 활성 상태 제거
                    document.querySelector(".tab-list li.active")?.classList.remove("active");
                    document.querySelector(".tab-content.active")?.classList.remove("active");

                    const targetContent = document.getElementById(targetTabId);

                    if (targetLi && targetContent) {
                        // 2. 새 탭과 콘텐츠 활성화
                        targetLi.classList.add("active");
                        targetContent.classList.add("active");

                        scrollToView(targetLi);
                    } else {
                        console.error(`[Tab Activation Failure] Could not find li or content for ID: ${targetTabId}`);
                    }
                };

                // --- 이벤트 리스너 설정 ---

                // 1. 탭 버튼 클릭 이벤트 (스크롤 영역 내의 탭만 처리)
                tabScrollArea?.addEventListener("click", (event) => {
                    const tabLink = event.target.closest(".tab-button");

                    if (tabLink) {
                        event.preventDefault();
                        const targetTabId = tabLink.dataset.tab;
                        const targetLi = tabLink.closest("li");

                        if (targetTabId && targetLi) {
                            activateTab(targetLi, targetTabId);
                        }
                    }
                });

                // 2. '더보기' 버튼 클릭 이벤트 (전역에서 처리) - **href="#tabN" 읽기 로직**
                document.body.addEventListener("click", (event) => {
                    const plusMoreLink = event.target.closest(".plusMore");

                    if (plusMoreLink) {
                        event.preventDefault();

                        const rawHref = plusMoreLink.getAttribute("href");

                        // ID 유효성 검사 (href가 없거나 #으로 시작하지 않는 경우)
                        if (!rawHref || !rawHref.startsWith("#") || rawHref.length <= 1) {
                            console.error("=========================================================================================");
                            console.error(`[CRITICAL HREF ERROR] '더보기' 버튼의 href 속성이 유효한 탭 ID를 포함하고 있지 않습니다. (예: href="#tab2") 현재 HTML 요소:`, plusMoreLink.outerHTML);
                            console.error(`▶ rawHref 값: ${rawHref}`);
                            console.error("=========================================================================================");
                            return;
                        }

                        // #을 제거하고 ID 추출
                        const targetTabId = rawHref.substring(1).trim();

                        // 🚨 V4.1: 추출된 ID가 빈 문자열인지 확인하는 명시적 디버깅 로직 추가
                        if (targetTabId === "") {
                            console.error("=========================================================================================");
                            console.error(`[CRITICAL EMPTY ID ERROR] Href 속성("${rawHref}")에서 탭 ID를 추출했지만, 결과가 빈 문자열입니다.`);
                            console.error("▶ '더보기' 버튼의 href 속성에 # 뒤에 유효한 탭 ID(예: #tab2)가 있는지 확인해 주세요. (예: href=\"#tab2\")");
                            console.error("=========================================================================================");
                            return;
                        }

                        // 탭 목록(.tab-list)에서 해당 ID를 가진 data-tab 속성을 가진 .tab-button을 찾습니다.
                        const tabSelector = `.tab-list .tab-button[data-tab="${targetTabId}"]`;
                        const targetA = document.querySelector(tabSelector);
                        const targetLi = targetA?.closest("li");

                        if (targetLi) {
                            // 탭을 찾은 경우 활성화
                            activateTab(targetLi, targetTabId);
                        } else {
                            // 탭 목록에서 LI를 찾지 못한 경우
                            console.error("=========================================================================================");
                            console.error(`[CRITICAL TAB LINKING ERROR - ID: "${targetTabId}"] 탭 목록에서 해당 탭 LI 요소를 찾지 못했습니다.`);
                            console.error(`▶ 스크립트가 찾지 못한 탭 항목의 선택자: ${tabSelector}`);
                            console.error("▶ '탭 목록'(.tab-list)에 'data-tab' 속성이 일치하는 항목이 있는지 확인해 주세요.");
                            console.error("▶ 문제가 되는 HTML 요소:", plusMoreLink.outerHTML.replace(/\s+/g, " ").trim());
                            console.error("=========================================================================================");
                        }
                    }
                });

                // 3. 스크롤 버튼 이벤트 리스너
                scrollLeftBtn?.addEventListener("click", () => {
                    if (!scrollLeftBtn.disabled && tabScrollArea) {
                        tabScrollArea.scrollBy({ left: -SCROLL_AMOUNT, behavior: "smooth" });
                    }
                });

                scrollRightBtn?.addEventListener("click", () => {
                    if (!scrollRightBtn.disabled && tabScrollArea) {
                        tabScrollArea.scrollBy({ left: SCROLL_AMOUNT, behavior: "smooth" });
                    }
                });

                // 4. 사용자 스크롤 또는 리사이즈 시 버튼 상태 업데이트
                tabScrollArea?.addEventListener("scroll", updateScrollButtons);
                window.addEventListener("resize", updateScrollButtons);

                // --- 초기화 로직 ---
                const initializeTabs = () => {
                    if (isInitialized) return;

                    let initialTabId = null;
                    let initialTabLi = null;

                    // 1. URL 해시(#tabN) 기준 찾기
                    if (window.location.hash) {
                        initialTabId = window.location.hash.substring(1);
                        const targetA = document.querySelector(`.tab-list .tab-button[data-tab="${initialTabId}"]`);
                        initialTabLi = targetA?.closest("li");
                    }

                    // 2. 초기 활성 탭 찾기 (active 클래스 기준)
                    if (!initialTabId) {
                        initialTabLi = document.querySelector(".tab-list li.active");

                        if (initialTabLi) {
                            initialTabId = initialTabLi.querySelector(".tab-button")?.dataset.tab;
                        }
                    }

                    // 3. 첫 번째 탭을 기본값으로 사용
                    if (!initialTabId) {
                        initialTabLi = document.querySelector(".tab-list li");
                        initialTabId = initialTabLi?.querySelector(".tab-button")?.dataset.tab;
                    }

                    // 탭 활성화 및 상태 업데이트
                    if (initialTabId && initialTabLi) {
                        activateTab(initialTabLi, initialTabId);
                        isInitialized = true;
                    } else {
                        console.warn("No tab elements found for initial activation.");
                    }

                    updateScrollButtons();

                    if (typeof tabObserver !== "undefined" && tabObserver) {
                        tabObserver.disconnect();
                    }
                };

                // DOM 콘텐츠가 완전히 로드된 후 또는 동적으로 탭이 추가되었을 때 초기화
                let tabObserver = null;

                if (tabListContainer && tabListContainer.querySelector("li")) {
                    // 이미 탭이 존재하는 경우 즉시 초기화
                    initializeTabs();
                } else if (tabListContainer) {
                    // 탭 리스트가 비어있다면, MutationObserver를 사용하여 리스트 항목이 추가될 때 초기화
                    tabObserver = new MutationObserver((mutationsList, observer) => {
                        const tabExists = document.querySelector(".tab-list li");
                        if (tabExists && !isInitialized) {
                            initializeTabs();
                            observer.disconnect();
                        }
                    });
                    tabObserver.observe(tabListContainer, {
                        childList: true,
                        subtree: false,
                    });
                } else {
                    console.error("The '.tab-list' container was not found. Cannot initialize tabs.");
                }
            });
        </script>

        <!-------- 2025-11-20 소스 원본(개발팀)---------

<form class="search-form" onsubmit="loadSearchResult(); return false;">
    <input id="searchText" type="text" placeholder="검색어 입력" />
    <input id="refineText" type="text" placeholder="결과 내 재검색" />
    <input type="submit" value="검색" />
</form>

<div id="boardTabs" class="tabs"></div>
<div id="searchResult"></div>

<script type="text/javascript">
    var __initialData = [];
    var __lastParams  = null;
    var __mode        = 'grouped';
    var __activeBbsId = null;

    function highlightKeyword(text, keyword) {
        return text || '';
    }

    function getBoardName(bbsId) {
        for (let b of __initialData) {
            if (b.bbsId === bbsId) return b.bbsNm;
        }
        return '';
    }

    function renderTabs(data) {
        var $tabs = $('#boardTabs');
        $tabs.empty();
        if (!data || data.length === 0) { $tabs.hide(); return; }

        var totalCount = 0;
        data.forEach(b => totalCount += (b.totalCount || 0));

        var $allBtn = $('<button/>', { 'class': 'tab-btn', type: 'button' })
                .text('전체 (' + totalCount + ')')
                .toggleClass('active', __mode === 'grouped')
                .on('click', function() {
                    __mode = 'grouped';
                    __activeBbsId = null;
                    renderGrouped(__initialData);
                    $('.tabs .tab-btn').removeClass('active');
                    $(this).addClass('active');
                });
        $tabs.append($allBtn);

        data.forEach(board => {
            var count = board.totalCount || (board.bbsList ? board.bbsList.length : 0);
            if (count === 0) return;

            var $btn = $('<button/>', { 'class': 'tab-btn', type: 'button' })
                    .text(board.bbsNm + ' (' + count + ')')
                    .toggleClass('active', __mode === 'board' && __activeBbsId === board.bbsId)
                    .data('bbs-id', board.bbsId)
                    .on('click', function() {
                        var bbsId = $(this).data('bbs-id');
                        __mode = 'board';
                        __activeBbsId = bbsId;
                        loadSearchAllByBoardId(bbsId);
                        $('.tabs .tab-btn').removeClass('active');
                        $(this).addClass('active');
                    });
            $tabs.append($btn);
        });

        $tabs.show();
    }

    function renderGrouped(data) {
        const $container = $('#searchResult');
        $container.empty();
        if (!data || data.length === 0) {
            $container.html('<p class="empty">검색 결과가 없습니다.</p>');
            return;
        }
        const keyword = ($('#refineText').val() || $('#searchText').val() || '').trim();

        data.forEach(board => {
            const allPosts = board.bbsList || [];
            if (allPosts.length === 0) return;
            const posts = allPosts.slice(0, 3);

            const sectionId = 'board-' + board.bbsId;
            const $section = $('<section/>', { id: sectionId, 'class': 'board-section' });
            const $title = $('<h3/>').text(board.bbsNm);
            const $list = $('<ul/>');

            posts.forEach(post => {
                const href = '/board/realEstateNewsView?bbsId=' + post.bbsId + '&sn=' + post.sn;
                const highlightedTitle = highlightKeyword(post.titl, keyword);
                const $li = $('<li/>').append($('<a/>', { href: href, html: highlightedTitle }));
                $list.append($li);
            });

            $section.append($title).append($list);
            $container.append($section);
        });
    }

    function renderBoardAll(bbsId, bbsNm, posts) {
        const $container = $('#searchResult');
        $container.empty();

        const sectionId = 'board-' + bbsId;
        const $section = $('<section/>', { id: sectionId, 'class': 'board-section' });
        const $title = $('<h3/>').text(bbsNm + ' - 전체 게시글');
        const $list = $('<ul/>');

        const keyword = ($('#refineText').val() || $('#searchText').val() || '').trim();

        if (posts && posts.length > 0) {
            posts.forEach(post => {
                const href = '/board/realEstateNewsView?bbsId=' + post.bbsId + '&sn=' + post.sn;
                const highlightedTitle = highlightKeyword(post.titl, keyword);
                const $li = $('<li/>').append($('<a/>', { href: href, html: highlightedTitle }));
                $list.append($li);
            });
        } else {
            $list.append('<li class="empty">게시글이 없습니다.</li>');
        }

        $section.append($title).append($list);
        $container.append($section);
        $('html, body').animate({ scrollTop: $('#' + sectionId).offset().top - 12 }, 250);
    }

    function loadSearchAllByBoardId(bbsId) {
        const params = {
            bbsId: bbsId,
            searchText: (__lastParams && __lastParams.searchText) || '',
            refineSearchText: (__lastParams && __lastParams.refineSearchText) || '',
            offset: 0,
            limit: 999
        };

        $.ajax({
            url: '/search/api/result',
            type: 'get',
            data: params,
            dataType: 'json',
            success: function (res) {
                if (res && res.code === "200") {
                    renderBoardAll(bbsId, getBoardName(bbsId), res.data || []);
                } else {
                    alert(res && res.message ? res.message : '목록을 불러오지 못했습니다.');
                }
            },
            error: function () {
                alert('게시판 전체 목록 조회 중 오류가 발생했습니다.');
            }
        });
    }

    function loadSearchResult() {
        const param = {
            searchText: $('#searchText').val(),
            refineSearchText: $('#refineText').val()
        };
        __lastParams = param;

        $.ajax({
            url: '/search/api/result',
            type: 'get',
            data: param,
            headers: {"logging-type": "07"}, // 통합검색
            dataType: 'json',
            success: function (res) {
                if (res && res.code === "200") {
                    __initialData = res.data || [];
                    __mode = 'grouped';
                    __activeBbsId = null;

                    renderTabs(__initialData);
                    renderGrouped(__initialData);
                } else {
                    alert(res && res.message ? res.message : '처리 중 문제가 발생했습니다.');
                }
            },
            error: function () {
                alert("검색 요청 중 오류가 발생했습니다.");
            }
        });
    }

    $(function(){
        var initialSearch = '<c:out value="${searchText}" />';
        if (initialSearch && initialSearch.trim() !== '') {
            $('#searchText').val(initialSearch);
            loadSearchResult();           // 바로 검색 실행
        }

        $('#searchText, #refineText').on('keydown', function(e){
            if (e.key === 'Enter') {
                e.preventDefault();
                loadSearchResult();
            }
        });
    });
</script>
-->
    </body>
</html>
